/*
 * API_lcd.c
 *
 *  Created on: 14 mar. 2023
 *      Author: ipave
 */


#include "API_lcd.h"
#include "API_Lcd_port.h"
#include "API_delay.h"


void LCD_Init(void){

  // Chip_GPIO_WritePortBit(LPC_GPIO,2,RS,OFF); //RS
   //Chip_GPIO_WritePortBit(LPC_GPIO,2,EN,OFF);
   LCD_HW_init();
   LCDdelay(1000);
   sacar(0x03,CONTROL);
   LCDdelay(DelayTime);
   sacar(0x03,CONTROL);
   LCDdelay(DelayTime);
   sacar(0x03,CONTROL);
   sacar(0x02,CONTROL);
   ControlLCD(0x28);
   ControlLCD(0x08);
   ControlLCD(0x01);
   for(int i=0;i<=10000000;i++);
   ControlLCD(0x06);
   ControlLCD(0x0C);

}

void LCDdelay(unsigned long nof) {
	  HAL_Delay(nof);
}


void ControlLCD(char valor){
	envia (valor,CONTROL);
}

void DatoLCD (char dato){
	envia(dato,DATOS);
}

void envia (unsigned char valor,unsigned char tipo){

		sacar(valor>>4,tipo);
		sacar(valor&0x0f,tipo);

}

void sacar (unsigned char valor, unsigned char tipo){
		/*
			LPC_GPIO[2].PIN = ((LPC_GPIO[2].PIN & 0xfffffff0)| (valor & 0x0f));
			Chip_GPIO_WritePortBit(LPC_GPIO,2,RS,tipo); //RS
			Chip_GPIO_WritePortBit(LPC_GPIO,2,EN,ON);
		*/
		LCD_Write_Byte(valor);
		LCDdelay(DelayTime);
		//Chip_GPIO_WritePortBit(LPC_GPIO,2,EN,OFF);
		LCD_Write_Byte(valor);
		LCDdelay(DelayTime);

}


void outtext (char *texto){
	while(*texto)
  	DatoLCD(*texto++);
}

void ClrLcd(void){
   unsigned int cnt;
   ControlLCD(CLR_CMD);				//	Display Clear.
   for(cnt=0;cnt<600;cnt++);	// El borrado del display tarda  1.52 ms.
}
