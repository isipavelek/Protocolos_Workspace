/*
 * API_encoder.c
 *
 *  Created on: 1 abr. 2023
 *      Author: ipave
 */

#include "API_encoder.h"
#include "API_enc_port.h"


static uint8_t estado;

uint8_t giro=NOGIRA;

delay_t encoder_time;

_Bool Init_Enc(void){
	Init_Enc_port();
    delayInit(&encoder_time,DEMORA_BASE);
    estado=INI;
	return 0;
}

void EncFSM_Update(){

	uint8_t estados_pines=Leer_Enc_Pin();
	switch (estado){
		case INI: if(estados_pines==3)estado=E11;
				  if(estados_pines==0)estado=E00;
				  break;
		case E00:if(estados_pines==1)estado=E01Der;
				  if(estados_pines==2)estado=E10Izq;
				  break;
		case E01Izq:if(estados_pines==3)estado=E11;
				  if(estados_pines==0){
					  giro=IZQ;
					  estado=E00;
				  }
				  break;
		case E10Der:
				  if(estados_pines==0){
					  giro=DER;
					  estado=E00;
				  }
				  if(estados_pines==3)estado=E11;
				  break;

		case E01Der:if(estados_pines==3){
						giro=DER;
						estado=E11;
					}
				  if(estados_pines==0)estado=E00;
				  break;
		case E10Izq:if(estados_pines==3){
					giro=IZQ;
					estado=E11;
				  }
				  if(estados_pines==0)estado=E00;
				  break;
		case E11: if(estados_pines==1)estado=E01Izq;
				  if(estados_pines==2)estado=E10Der;
				  break;

	}
	/*switch (estado){
			case (E00):	if(estados_pines!=E00 && estados_pines!=E11)estado=estados_pines;
						break;
			case (E01):	if(estados_pines!=E01){
							if(estados_pines==E00)giro=IZQ;
							else giro=DER;
							estado=E00;
						}
						break;
			case (E10): if(estados_pines!=E10){
							if(estados_pines==E00)giro=DER;
							else giro=IZQ;
							estado=E00;
						}
						break;

	}*/
}

giro_encoder_t ReadEncoder(){
	uint8_t aux=0;
	aux=giro;
	giro=NOGIRA;
	return aux;

}
