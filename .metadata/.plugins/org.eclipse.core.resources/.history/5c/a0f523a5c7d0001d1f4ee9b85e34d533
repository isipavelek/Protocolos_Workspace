/*
 * API_encoder.c
 *
 *  Created on: 1 abr. 2023
 *      Author: ipave
 */

#include "API_encoder.h"
#include "API_enc_port.h"


static uint8_t estado=INICIAL;

#define IZQ 1
#define IZQ 2
uint8_t giro=false;

typedef enum{
	NOGIRA,IZQ,DER

}giro_encoder;





delay_t encoder_time;

_Bool Init_Enc(void){
	Init_Enc_port();
	estado=INICIAL;
	StateEncoder_t.EstadoCanalA=false;
	StateEncoder_t.EstadoCanalB=false;
	StateEncoder_t.EstadoPrevCanalA=false;
	StateEncoder_t.EstadoPrevCanalB=false;
    delayInit(&encoder_time,DEMORA_BASE);
    estado=Leer_Enc_Pin();
	return 0;
}

void EncUpdate(){

//	if(delayRead(&estructura_tiempo)){
	uint8_t estados_pines=Leer_Enc_Pin();
	switch (estado){
			case (E00):	if(estados_pines!=E00){
							if(esatados_pines==E01){
								giro=IZQ;
								estado=E01;
							}
							else {
								giro=DER;
								estado=E10;
							}
						}
					break;
			case (E01):	if(estados_pines!=E01){
							if(esatados_pines==E00){
								giro=IZQ;
								estado=E00;
							}
							else {
								giro=DER;
								estado=E11;
							}
						}
					break;
			case (E10): if(estados_pines!=E10){
							if(esatados_pines==E00){
								giro=IZQ;
								estado=E00;
							}
							else {
								giro=DER;
								estado=E11;
							}
						}
						break;

			case (E11):if(estados_pines!=E11){
							if(esatados_pines==E01){
								giro=IZQ;
								estado=E01;
							}
							else {
								giro=DER;
								estado=E10;
							}
						}

					break;

			}
	//}
}


