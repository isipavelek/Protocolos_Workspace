/*
 * API_encoder.c
 *
 *  Created on: 1 abr. 2023
 *      Author: ipave
 */

#include "API_encoder.h"
#include "API_enc_port.h"


static uint8_t estado;

uint8_t giro=NOGIRA;

delay_t encoder_time;

_Bool Init_Enc(void){
	Init_Enc_port();
    delayInit(&encoder_time,DEMORA_BASE);
    estado=Leer_Enc_Pin();
	return 0;
}

void EncUpdate(){

	uint8_t estados_pines=Leer_Enc_Pin();

		switch (estado){
				case (E00):	if(estados_pines!=E00){
								if(estados_pines!=E11)estado=estados_pines;
							}
						break;
				case (E01):	if(estados_pines!=E01){
								if(estados_pines==E00){
//									giro=DER;
									estado=E00;
								}
								else {
									giro=IZQ;
									estado=E11;
								}
							}
						break;
				case (E10): if(estados_pines!=E10){
								if(estados_pines==E00){
									//giro=IZQ;
									estado=E00;
								}
								else {
									giro=DER;
									estado=E11;
								}
							}
							break;

				case (E11):if(estados_pines!=E00)estado=estados_pines;

							break;

				}
	}



giro_encoder_t ReadEncoder(){
	uint8_t aux=0;
	aux=giro;
	giro=NOGIRA;
	return aux;

}
